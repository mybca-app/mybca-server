@model MyBCA.Server.Models.Bus.Responses.BusListTemplate

@{
    ViewData["Title"] = "myBCA Buses";
    ViewData["Description"] = "Say goodbye to broken apps and clunky spreadsheets. Easily see where your BCA bus is parked in the lower lot for dismissal with myBCA Buses.";
}

@section Head {
    <link rel="stylesheet" href="~/css/buslist.css">
}

@section Scripts {
    <script src="~/js/buslist.js"></script>
}

@section Navbar {
    @await Html.PartialAsync("_BusNavbar")
}

<h1>ðŸ‘‹ Hello there.</h1>
<section>
    @if (Model.Expiry is DateTime expiry)
    {
        <p>
            We'll fetch new data from the bus spreadsheet at
            <mark>@expiry.ToShortTimeString()</mark>.
        </p>
    }
    <section id="instagram-browser-warning" style="display: none">
        <h2>Aagh!</h2>
        <p>
            You are using the Instagram in-app browser. If you want to install our
            mobile app, you must open this page in your phone's default browser - tap on
            the three dots in the top right and choose "Open in external browser."
        </p>
    </section>
    <section id="pwa-install-guide" style="display: none">
        <h2>Install on your phone</h2>
        <details>
            <summary>Install on iOS (Safari)</summary>
            <ol>
                <li>Press the Share button at the bottom center of the screen</li>
                <li>Tap "Add to Home Screen"</li>
                <li>Confirm by clicking "Add" in the top right corner</li>
            </ol>
        </details>
        <details>
            <summary>Install on Android (Chrome)</summary>
            <ol>
                <li>Press the three dots at the top right of the screen</li>
                <li>Tap "Add to Home Screen" -> "Install"</li>
                <li>Follow the on-screen instructions to install</li>
            </ol>
        </details>
    </section>
    <table>
        <thead>
            <tr>
                <th scope="col"></th>
                <th scope="col">Town</th>
                <th scope="col">Pos.</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var location in Model.Favorites)
            {
                <tr>
                    <td class="favorites-button-cell">
                        <form asp-controller="Bus" asp-action="RemoveFavorite" method="post">
                            <input type="hidden" name="name" value="@location.Town" />
                            <button type="submit" aria-label="Remove favorite">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" stroke-width="1.5" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.562.562 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.562.562 0 0 0-.182-.557l-4.204-3.602a.562.562 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z"></path>
                                </svg>
                            </button>
                        </form>
                    </td>
                    <th scope="row">@location.Town</th>
                    <td>@location.Location</td>
                </tr>
            }
            @foreach (var location in Model.Positions)
            {
                <tr>
                    <td>
                        <form asp-controller="Bus" asp-action="AddFavorite" method="post">
                            <input type="hidden" name="name" value="@location.Town" />
                            <button type="submit" class="outline" aria-label="Add favorite">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" width="24" stroke-width="1.5" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.562.562 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.562.562 0 0 0-.182-.557l-4.204-3.602a.562.562 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z"></path>
                                </svg>
                            </button>
                        </form>
                    </td>
                    <th scope="row">@location.Town</th>
                    <td>@location.Location</td>
                </tr>
            }
        </tbody>
    </table>
</section>